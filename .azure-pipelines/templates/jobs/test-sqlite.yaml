jobs:
- job: 'Sqlite'
  pool:
    vmImage: 'ubuntu-16.04' # other options: 'macOS-10.13', 'vs2017-win2016'

  strategy:
    matrix:
      Python36:
        python.version: '3.6'
      Python37:
        python.version: '3.7'

  steps:
    - template: /.azure-pipelines/templates/steps/install-project.yaml
      parameters:
        python_version: $(python.version)

    - script: coverage run -m bgmi install --no-web
    - script: |
        mkdir -p ~/data
        curl -L https://github.com/BGmi/BGmi/releases/download/test-data/data-1.sql -o ~/data/db.sql
      displayName: Download Test Data

    - script: coverage run -m pytest tests/test_db_models.py --reruns 0
      displayName: Unittest
      env:
        DB_SQL_PATH: ~/data/db.sql

    - task: PublishTestResults@2
      condition: succeededOrFailed()
      inputs:
        testResultsFiles: 'junit/test_*.xml'
        testRunTitle: 'Publish test results for Python $(python.version)'
